<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - ZidioConnect</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1, h2 { color: #2c3e50; }
        .token-input { margin-bottom: 20px; }
        .section { margin-top: 40px; padding: 20px; border: 1px solid #eee; border-radius: 6px; background: #fafbfc; }
        label { display: block; margin-top: 10px; }
        input, textarea, select { width: 100%; padding: 6px; margin-top: 4px; }
        button { margin-top: 16px; padding: 8px 16px; background: #3498db; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #217dbb; }
        .error { color: red; }
        .success { color: green; }
        table { border-collapse: collapse; width: 100%; margin-top: 16px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>ZidioConnect Admin Panel</h1>
    <div class="token-input">
        <label for="jwtToken">JWT Token:</label>
        <input type="text" id="jwtToken" placeholder="Paste your JWT token here" style="width: 60%;">
        <button onclick="saveToken()">Save Token</button>
        <span id="tokenStatus"></span>
    </div>

    <!-- USERS SECTION -->
    <div class="section">
        <h2>Users</h2>
        <form id="userForm">
            <label>Name: <input type="text" id="userName" required></label>
            <label>Email: <input type="email" id="userEmail" required></label>
            <label>Password: <input type="password" id="userPassword" required></label>
            <label>Role:
                <select id="userRole" required>
                    <option value="STUDENT">STUDENT</option>
                    <option value="RECRUITER">RECRUITER</option>
                    <option value="ADMIN">ADMIN</option>
                </select>
            </label>
            <label>Username: <input type="text" id="userUsername"></label>
            <button type="submit">Create User</button>
            <span id="userFormStatus"></span>
        </form>
        <button onclick="fetchUsers()">View All Users</button>
        <div id="userList"></div>
    </div>

    <!-- JOB LISTINGS SECTION -->
    <div class="section">
        <h2>Job Listings</h2>
        <form id="jobForm">
            <label>Title: <input type="text" id="title" required></label>
            <label>Description: <textarea id="description" required></textarea></label>
            <label>Type:
                <select id="type" required>
                    <option value="Full Time">Full Time</option>
                    <option value="Part Time">Part Time</option>
                    <option value="Internship">Internship</option>
                    <option value="Contract">Contract</option>
                </select>
            </label>
            <label>Location: <input type="text" id="location" required></label>
            <label>Remote:
                <select id="remote" required>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </label>
            <label>Start Date: <input type="date" id="startDate" required></label>
            <label>Duration (weeks): <input type="number" id="durationWeeks" required></label>
            <label>Stipend: <input type="number" id="stipend" required></label>
            <label>Posted At: <input type="datetime-local" id="postedAt" required></label>
            <label>Expiry Date: <input type="datetime-local" id="expiryDate" required></label>
            <label>Is Active:
                <select id="isActive" required>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
            </label>
            <button type="submit">Create Job</button>
            <span id="jobFormStatus"></span>
        </form>
        <button onclick="fetchJobs()">View All Job Listings</button>
        <div id="jobList"></div>
    </div>

    <!-- APPLICATIONS SECTION -->
    <div class="section">
        <h2>Applications</h2>
        <form id="applicationForm">
            <label>Job Listing ID: <input type="number" id="appJobId" required></label>
            <label>Applicant User ID: <input type="number" id="appUserId" required></label>
            <label>Status:
                <select id="appStatus" required>
                    <option value="PENDING">PENDING</option>
                    <option value="ACCEPTED">ACCEPTED</option>
                    <option value="REJECTED">REJECTED</option>
                </select>
            </label>
            <button type="submit">Create Application</button>
            <span id="applicationFormStatus"></span>
        </form>
        <button onclick="fetchApplications()">View All Applications</button>
        <div id="applicationList"></div>
    </div>

    <!-- RECRUITER PROFILES SECTION -->
    <div class="section">
        <h2>Recruiter Profiles</h2>
        <form id="recruiterForm">
            <label>User ID: <input type="number" id="recruiterUserId" required></label>
            <label>Company Name: <input type="text" id="companyName" required></label>
            <label>Designation: <input type="text" id="designation" required></label>
            <button type="submit">Create Recruiter Profile</button>
            <span id="recruiterFormStatus"></span>
        </form>
        <button onclick="fetchRecruiters()">View All Recruiter Profiles</button>
        <div id="recruiterList"></div>
    </div>

    <!-- STUDENT PROFILES SECTION -->
    <div class="section">
        <h2>Student Profiles</h2>
        <form id="studentForm">
            <label>User ID: <input type="number" id="studentUserId" required></label>
            <label>Education: <input type="text" id="education" required></label>
            <label>Skills: <input type="text" id="skills" required></label>
            <button type="submit">Create Student Profile</button>
            <span id="studentFormStatus"></span>
        </form>
        <button onclick="fetchStudents()">View All Student Profiles</button>
        <div id="studentList"></div>
    </div>

    <!-- ADMIN PROFILES SECTION -->
    <div class="section">
        <h2>Admin Profiles</h2>
        <form id="adminForm">
            <label>User ID: <input type="number" id="adminUserId" required></label>
            <label>Department: <input type="text" id="department" required></label>
            <button type="submit">Create Admin Profile</button>
            <span id="adminFormStatus"></span>
        </form>
        <button onclick="fetchAdmins()">View All Admin Profiles</button>
        <div id="adminList"></div>
    </div>

    <script>
        // Save token to localStorage
        function saveToken() {
            const token = document.getElementById('jwtToken').value.trim();
            if (token) {
                localStorage.setItem('jwtToken', token);
                document.getElementById('tokenStatus').textContent = 'Token saved!';
                document.getElementById('tokenStatus').className = 'success';
            } else {
                document.getElementById('tokenStatus').textContent = 'Please enter a token.';
                document.getElementById('tokenStatus').className = 'error';
            }
        }

        // USERS
        document.getElementById('userForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const status = document.getElementById('userFormStatus');
            status.textContent = '';
            const user = {
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                password: document.getElementById('userPassword').value,
                role: document.getElementById('userRole').value,
                username: document.getElementById('userUsername').value
            };
            try {
                const res = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(user)
                });
                if (!res.ok) throw new Error(await res.text());
                status.textContent = 'User created!';
                status.className = 'success';
                fetchUsers();
                this.reset();
            } catch (err) {
                status.textContent = err.message;
                status.className = 'error';
            }
        });
        async function fetchUsers() {
            const res = await fetch('/api/user/list');
            const users = await res.json();
            let html = '<table><tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Username</th></tr>';
            users.forEach(u => {
                html += `<tr><td>${u.id}</td><td>${u.name}</td><td>${u.email}</td><td>${u.role}</td><td>${u.username || ''}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('userList').innerHTML = html;
        }

        // JOB LISTINGS
        document.getElementById('jobForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const status = document.getElementById('jobFormStatus');
            status.textContent = '';
            const token = localStorage.getItem('jwtToken');
            const job = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                type: document.getElementById('type').value,
                location: document.getElementById('location').value,
                remote: document.getElementById('remote').value === 'true',
                startDate: document.getElementById('startDate').value,
                durationWeeks: parseInt(document.getElementById('durationWeeks').value),
                stipend: parseFloat(document.getElementById('stipend').value),
                postedAt: document.getElementById('postedAt').value,
                expiryDate: document.getElementById('expiryDate').value,
                isActive: document.getElementById('isActive').value === 'true'
            };
            try {
                const res = await fetch('/api/joblistings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token ? { 'Authorization': 'Bearer ' + token } : {})
                    },
                    body: JSON.stringify(job)
                });
                if (!res.ok) throw new Error(await res.text());
                status.textContent = 'Job created!';
                status.className = 'success';
                fetchJobs();
                this.reset();
            } catch (err) {
                status.textContent = err.message;
                status.className = 'error';
            }
        });
        async function fetchJobs() {
            const token = localStorage.getItem('jwtToken');
            const res = await fetch('/api/joblistings', {
                headers: token ? { 'Authorization': 'Bearer ' + token } : {}
            });
            const jobs = await res.json();
            let html = '<table><tr><th>ID</th><th>Title</th><th>Posted By</th><th>Type</th><th>Location</th><th>Remote</th><th>Stipend</th><th>Duration</th><th>Start</th><th>Expiry</th><th>Active</th></tr>';
            jobs.forEach(j => {
                html += `<tr><td>${j.id}</td><td>${j.title}</td><td>${j.postedByName || ''} (${j.postedById || ''})</td><td>${j.type}</td><td>${j.location}</td><td>${j.remote ? 'Yes' : 'No'}</td><td>${j.stipend}</td><td>${j.durationWeeks}</td><td>${j.startDate}</td><td>${j.expiryDate}</td><td>${j.isActive ? 'Yes' : 'No'}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('jobList').innerHTML = html;
        }

        // APPLICATIONS
        document.getElementById('applicationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const status = document.getElementById('applicationFormStatus');
            status.textContent = '';
            const token = localStorage.getItem('jwtToken');
            const app = {
                jobListingId: parseInt(document.getElementById('appJobId').value),
                applicantId: parseInt(document.getElementById('appUserId').value),
                status: document.getElementById('appStatus').value
            };
            try {
                const res = await fetch('/api/applications', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token ? { 'Authorization': 'Bearer ' + token } : {})
                    },
                    body: JSON.stringify(app)
                });
                if (!res.ok) throw new Error(await res.text());
                status.textContent = 'Application created!';
                status.className = 'success';
                fetchApplications();
                this.reset();
            } catch (err) {
                status.textContent = err.message;
                status.className = 'error';
            }
        });
        async function fetchApplications() {
            const token = localStorage.getItem('jwtToken');
            const res = await fetch('/api/applications', {
                headers: token ? { 'Authorization': 'Bearer ' + token } : {}
            });
            const apps = await res.json();
            let html = '<table><tr><th>ID</th><th>Job ID</th><th>Applicant ID</th><th>Status</th><th>Applied At</th></tr>';
            apps.forEach(a => {
                html += `<tr><td>${a.id}</td><td>${a.jobListingId}</td><td>${a.applicantId}</td><td>${a.status}</td><td>${a.appliedAt || ''}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('applicationList').innerHTML = html;
        }

        // RECRUITER PROFILES
        document.getElementById('recruiterForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const status = document.getElementById('recruiterFormStatus');
            status.textContent = '';
            const token = localStorage.getItem('jwtToken');
            const recruiter = {
                userId: parseInt(document.getElementById('recruiterUserId').value),
                companyName: document.getElementById('companyName').value,
                designation: document.getElementById('designation').value
            };
            try {
                const res = await fetch('/api/recruiter-profiles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token ? { 'Authorization': 'Bearer ' + token } : {})
                    },
                    body: JSON.stringify(recruiter)
                });
                if (!res.ok) throw new Error(await res.text());
                status.textContent = 'Recruiter profile created!';
                status.className = 'success';
                fetchRecruiters();
                this.reset();
            } catch (err) {
                status.textContent = err.message;
                status.className = 'error';
            }
        });
        async function fetchRecruiters() {
            const token = localStorage.getItem('jwtToken');
            const res = await fetch('/api/recruiter-profiles', {
                headers: token ? { 'Authorization': 'Bearer ' + token } : {}
            });
            const recruiters = await res.json();
            let html = '<table><tr><th>ID</th><th>User ID</th><th>Company Name</th><th>Designation</th></tr>';
            recruiters.forEach(r => {
                html += `<tr><td>${r.id}</td><td>${r.userId}</td><td>${r.companyName}</td><td>${r.designation}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('recruiterList').innerHTML = html;
        }

        // STUDENT PROFILES
        document.getElementById('studentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const status = document.getElementById('studentFormStatus');
            status.textContent = '';
            const token = localStorage.getItem('jwtToken');
            const student = {
                userId: parseInt(document.getElementById('studentUserId').value),
                education: document.getElementById('education').value,
                skills: document.getElementById('skills').value
            };
            try {
                const res = await fetch('/api/student-profiles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token ? { 'Authorization': 'Bearer ' + token } : {})
                    },
                    body: JSON.stringify(student)
                });
                if (!res.ok) throw new Error(await res.text());
                status.textContent = 'Student profile created!';
                status.className = 'success';
                fetchStudents();
                this.reset();
            } catch (err) {
                status.textContent = err.message;
                status.className = 'error';
            }
        });
        async function fetchStudents() {
            const token = localStorage.getItem('jwtToken');
            const res = await fetch('/api/student-profiles', {
                headers: token ? { 'Authorization': 'Bearer ' + token } : {}
            });
            const students = await res.json();
            let html = '<table><tr><th>ID</th><th>User ID</th><th>Education</th><th>Skills</th></tr>';
            students.forEach(s => {
                html += `<tr><td>${s.id}</td><td>${s.userId}</td><td>${s.education}</td><td>${s.skills}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('studentList').innerHTML = html;
        }

        // ADMIN PROFILES
        document.getElementById('adminForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const status = document.getElementById('adminFormStatus');
            status.textContent = '';
            const token = localStorage.getItem('jwtToken');
            const admin = {
                userId: parseInt(document.getElementById('adminUserId').value),
                department: document.getElementById('department').value
            };
            try {
                const res = await fetch('/api/admin-profiles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token ? { 'Authorization': 'Bearer ' + token } : {})
                    },
                    body: JSON.stringify(admin)
                });
                if (!res.ok) throw new Error(await res.text());
                status.textContent = 'Admin profile created!';
                status.className = 'success';
                fetchAdmins();
                this.reset();
            } catch (err) {
                status.textContent = err.message;
                status.className = 'error';
            }
        });
        async function fetchAdmins() {
            const token = localStorage.getItem('jwtToken');
            const res = await fetch('/api/admin-profiles', {
                headers: token ? { 'Authorization': 'Bearer ' + token } : {}
            });
            const admins = await res.json();
            let html = '<table><tr><th>ID</th><th>User ID</th><th>Department</th></tr>';
            admins.forEach(a => {
                html += `<tr><td>${a.id}</td><td>${a.userId}</td><td>${a.department}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('adminList').innerHTML = html;
        }
    </script>
</body>
</html> 